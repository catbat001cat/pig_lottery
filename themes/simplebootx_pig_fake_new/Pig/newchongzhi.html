<!DOCTYPE HTML>
<html>
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
    <meta name="viewport" content="user-scalable=no, width=320">
    <meta name="format-detection" content="telephone=no" />
    <title>充值</title>
    <link rel="stylesheet" href="__TMPL__Public/cssdb/index.css" />
    <script src="__TMPL__Public/js/md5.js" type="application/javascript"></script>
    <script src="__TMPL__Public/jsdb/jquery.min.js" type="application/javascript"></script>
    <script src="__TMPL__Public/jsdb/jquery.cookie.js" type="application/javascript"></script>
    <script src="__TMPL__Public/jsdb/jquery.shCircleLoader.js" type="text/javascript"></script>
    <style>
        #shclDefault
        {
            width: 50px;
            height: 50px;
            margin-left: 125px;
            margin-top: -20px;
            position: absolute;
            z-index: 10;
        }
    </style>
</head>
<body align="center">
    <div class="all">
        <div style="width: 320px; height: 160px; background: url('__TMPL__Public/imgdb/head.png'); margin: 0 auto;
            text-align: center;" id="online">
            <div style="width: 280px; height: 105px; margin: 0px auto; float: left; margin-top: 25px;
                margin-left: 20px;">
                <div style="float: left; margin-top: 15px;">
                    <div style="font-size: 14px; color: white; margin-top: 28px;" id="username">
                    </div>
                </div>
                <div style="float: left; border-left: 1px solid #6d6d6d; height: 105px; margin-left: 12.5PX;">
                </div>
                <div style="float: left; margin-top: -10px; margin-left: 20px; text-align: left;">
                    <div style="color: white; margin-top: 5px;">
                        可用余额</div>
                    <div style="color: white; margin-top: 20px; font-size: 12px;">
                        <font style="font-size: 30px;" id="money_first">0</font></div>
                </div>
            </div>
        </div>
        <div id="item_template" style="display:none">
        	<div style="width: 80px; color: #A8A8A8; background: white; height: 34px; padding-top: 9px;
                line-height: 27px; border-radius: 4px; margin-top: 10px; margin-left: 10px; float: left;
                border: #EEEEEE 1px solid;" class="choosemoney{current}">
                <font style="font-size: 18px;" class="howmuch">{money}</font><font style="font-size: 10px;"></font></div>
        </div>
        <div style="width: 300px; margin-left: 11px; text-align: center">
            <div style="text-align: left; margin-top: 20px; font-size: 12px; color: #A8A8A8;">
                快速充值</div>
             <div id="container">
             </div>
            <!--
            <div style="width: 93px; color: white; background: #EE5859; height: 35px; line-height: 27px;
                padding-top: 9px; border-radius: 4px; margin-top: 10px; float: left;" class="choosemoney current">
                <font style="font-size: 18px;" class="howmuch">21</font><font style="font-size: 10px;"></font></div>
            <div style="width: 91px; color: #A8A8A8; background: white; height: 34px; padding-top: 9px;
                line-height: 27px; border-radius: 4px; margin-top: 10px; margin-left: 10px; float: left;
                border: #EEEEEE 1px solid;" class="choosemoney">
                <font style="font-size: 18px;" class="howmuch">50</font><font style="font-size: 10px;"></font></div>
            <div style="width: 91px; color: #A8A8A8; background: white; height: 34px; line-height: 27px;
                padding-top: 9px; border-radius: 4px; margin-top: 10px; margin-left: 10px; float: left;
                border: #EEEEEE 1px solid;" class="choosemoney">
                <font style="font-size: 18px;" class="howmuch">100</font><font style="font-size: 10px;"></font></div>
            <div class="clear">
            </div>
            <div style="width: 91px; color: #A8A8A8; background: white; height: 34px; padding-top: 9px;
                line-height: 27px; border-radius: 4px; margin-top: 10px; float: left; border: #EEEEEE 1px solid;"
                class="choosemoney">
                <font style="font-size: 18px;" class="howmuch">200</font><font style="font-size: 10px;"></font></div>
            <div style="width: 91px; color: #A8A8A8; background: white; height: 34px; line-height: 27px;
                padding-top: 9px; border-radius: 4px; margin-top: 10px; margin-left: 10px; float: left;
                border: #EEEEEE 1px solid;" class="choosemoney">
                <font style="font-size: 18px;" class="howmuch">500</font><font style="font-size: 10px;"></font></div>
            <div style="width: 91px; color: #A8A8A8; background: white; height: 34px; padding-top: 9px;
                line-height: 27px; border-radius: 4px; margin-top: 10px; margin-left: 10px; float: left;
                border: #EEEEEE 1px solid;" class="choosemoney">
                <font style="font-size: 18px;" class="howmuch">1000</font><font style="font-size: 10px;"></font></div>
		 	-->                
            <div id="shclDefault">
            </div>
            <button style="width: 299px; color: white; background: url('__TMPL__Public/imgdb/10-1.png') no-repeat;background-size:100% 100%; height: 42px; border-radius: 4px;
                margin-top: 30px; font-size: 16px; border: 0px; float: left" id="pay" class="big-button1">
                确认充值</button>
            <div style="clear: both">
            </div>
            <div style="text-align: left; margin-top: 10px; font-size: 12px; color: #A8A8A8;">
                充值由第三方收付款平台提供服务, 充值秒到账;<font style="color:red">具体金额以实际支付金额为准;</font>
            </div>
         
            <div style="text-align: left; font-size: 12px; color: #A8A8A8;">
                如您充值遇到问题，请联系客服QQ:   <php>
        $servicer_number = C('servicer_number');
        </php>
            {$servicer_number};
        </div>
    </div>
    <div style="width: 100%; top: 150px; position: absolute; z-index: 999;">
        <div style="background: #303031; border-radius: 20px; margin: 0 auto; padding: 11px 22px 11px 22px;
            color: white; display: none;" id="modal2">
            操作成功
        </div>
    </div>
    <!--footer-->
    <div style="border-top: #F0F0F0 0px solid; height: 45px; width: 100%; line-height: 44px;
        background: #272727; position: fixed; bottom: 0px; text-align: center; font-size: 16px;color:white"
        onclick="location.href='index.php?g=Pig&m=index&a=index'">
        返回首页
    </div>
    <div class="div_huibg" style="display: none;">
    </div>
    <div id="pay_item_template" style="display:none">
        <label id="alipay" name="alipay"  title="支付宝">
            <input type="radio" name="paytype" value="支付宝" onclick="javascript:select_channel('{type}');" />
            <img src="__TMPL__Public/img/winxin-big-img.png" alt="">
          	  {name}
        </label>    
    </div>
    <div id="paytypes" style="display: none;">
         <!--<h4>请选择支付方式</h4>--> 
         <foreach name="channels" item="vo">
	         <label id="{$vo['type']}" name="{$vo['type']}"  title="{$vo['name']}">
	            <input type="radio" name="paytype" value="{$vo['name']}" onclick="javascript:select_channel('{$vo['type']}');" />
	            <if condition="$vo.wx eq 1">
	            <img src="__TMPL__Public/img/winxin-big-img.png" alt="">
	            <else/>
	            <img src="__TMPL__Public/img/alipay-big-img.png" alt="">
	            </if>
	          	  {$vo['name']}
	        </label>    
         </foreach>
   		<!--
        <label id="alipay" name="alipay"  title="支付宝">
            <input type="radio" name="paytype" value="支付宝" onclick="javascript:selectpaytypealipay();" />
            <img src="__TMPL__Public/img/alipay-big-img.png" alt="">
            支付宝
        </label>
       <label id="qqpay" name="qqpay"  title="qq钱包支付">
            <input type="radio" name="paytype" value="qq钱包支付" onclick="javascript:selectpaytypeqqpay();" />
            <img src="__TMPL__Public/img/qq.png" alt="">
            QQ钱包
        </label>
       <label id="wx" name="wx" class="Sel" title="微信支付">
          <input type="radio" name="paytype" value="微信支付" onclick="javascript:selectpaytypewx();" />
            <img src="__TMPL__Public/img/winxin-big-img.png" alt="">
            微信支付
        </label>
         -->
    </div>
    <style>
        .big-button1
        {
            -webkit-tap-highlight-color: rgba(0,0,0,0);
            -webkit-user-select: none; /*webkit浏览器*/
        }
        .div_huibg
        {
            background: #000;
            opacity: 0.5;
            width: 100%;
            height: 100%;
            position: absolute;
            top: 0;
            z-index: 10;
        }
        #paytypes
        {
            width: 100%;
            background: #fff;
            position: absolute;
            bottom: 0;
            z-index: 20;
        }
        /*#paytypes h4{
        font-size: 12px;
        text-align: center;
        color: #999;
    }*/
        #paytypes label
        {
            text-align: center;
            display: block; /*background: #ff6600;*/
            height: 24vw;
            line-height: 24vw;
            margin: 0;
            margin-top: 1px;
            color: #4a4a4a;
            letter-spacing: 1px;
            font-size: 1.3rem;
            font-weight: 500;
        }
        #paytypes label:nth-child(1),#paytypes label:nth-child(2)
        {
            border-bottom: 1px solid #e1e1e1;
        }
        #paytypes label input
        {
            display: none;
        }
        #paytypes label img
        {
            width: 6vh;
            display: inline-block;
            margin-top: -1px;
            vertical-align: middle;
        }
    </style>
    <script>
        $('.big-button1').click(function () {
        	
        	// 直接跳转
        	var gross = 0;
            $(".choosemoney").each(function (e) {
                var val = $(this).attr("class");
                var array = val.split(" ");
                if (array[1] == 'current') {
                    gross = $(this).children().html();
                }
            });

            /*
        	var ticket = Date.parse(new Date());
        	var sign = hex_md5('create_order' + gross + ticket);
        	location.href = 'index.php?g=Qqonline&m=pay&a=create_order&price=' + gross + '&ticket=' + ticket + '&sign=' + sign;            
            */
            $('.div_huibg').fadeIn(500);
            $('#paytypes').slideDown(400);
        });

        $('.div_huibg').click(function () {
            $('.div_huibg').fadeOut(300);
            $('#paytypes').slideUp(200);
        });
        
        function select_channel(type)
        {
        	var gross = 0;
            $(".choosemoney").each(function (e) {
                var val = $(this).attr("class");
                var array = val.split(" ");
                if (array[1] == 'current') {
                    gross = $(this).children().html();
                }
            });
            
        	var ticket = Date.parse(new Date());
        	var sign = hex_md5('ajax_create_order' + gross + ticket + type);
        	
        	if (type == 'yubwx_ali_pay')
        	{
        		if (parseInt(gross) < 100)
        		{
        			success('支付宝充值单笔不能少于100元');
        			
            		return;
        		}
        	}
        	
        	success('即将跳转到支付');
            
            $.ajax({
                type: 'get',
                dataType: 'json',
                url: 'index.php?g=Qqonline&m=pay&a=ajax_create_order',
                data: {
                	price:gross,
                	ticket:ticket,
                	type:type,
                	sign:sign
                },
                success: function (data) {
                    if (data.ret == 1) {
                        window.location = data.url;
                    }
                    else if (data.ret == -2) {
                    	setTimeout(function(){WeixinJSBridge.call('closeWindow');},2000);
                    }
                    else {
                        success(data.msg);
                    }
                },
                error: function (XMLHttpRequest, textStatus, errorThrown) {
                    if (XMLHttpRequest.status == 401) {
                        success('没有权限');
                    }
                }
            });	
        }
    </script>
    <script>
        function success(title) {
            $("#modal2").fadeIn('fast');
            if (title) {
                $("#modal2").text(title);
            }
            $("#modal2").css('display', 'inline-block');
            $("#modal2").fadeIn('fast');
            window.setTimeout(function () {
                $("#modal2").fadeOut(1000);
            }, 2000);
        }

        function load_wallet()
        {
        	$.ajax({
                type: 'post',
                dataType: 'json',
                url: 'index.php?g=Qqonline&m=index&a=ajax_get_user_info',
                success: function (data) {
                	console.log(JSON.stringify(data));
                    if (data.ret == 1) {
                        $.cookie('user_money', data.wallet.money, { expires: 1 });
                        //$.cookie('user_reward_money', data.data.reward_money, { expires: 1 });
                        $.cookie('user_reward_money',0, { expires: 1 });
                        $("#username").text(data.info.id);
                        var money = parseFloat($.cookie('user_money')) + parseFloat($.cookie('user_reward_money'));
                        $("#money_first").text(money.toFixed(2));
                    }
                    else {
                        success(data.return_msg);
                    }
                },
                error: function (XMLHttpRequest, textStatus, errorThrown) {
                    if (XMLHttpRequest.status == 401) {
                        success('没有权限');
                        location.href = "/";
                    }
                }
            });	
        }
        
        function init_recharges()
        {
        	var orderNum=[{$recharge_prices}];
        	
        	for (var i=0; i<orderNum.length; i++)
        	{
        		var item_template = $('#item_template').html();
        		item_template = item_template.replace(/{money}/g, orderNum[i]);
        		
        		if (i == 0)
        			item_template = item_template.replace(/{current}/g, ' current');
        		else
        			item_template = item_template.replace(/{current}/g, '');

        		$('#container').append(item_template);
        	}
        }
        
        load_wallet();
        
        init_recharges();
        
        $(".choosemoney").click(function () {
            $(".choosemoney").css('background', 'white');
            $(".choosemoney").css('color', '#A8A8A8');
            $(".choosemoney").css('border', '#EEEEEE 1px solid');
            $(".choosemoney").css('height', '34px');
            //$(".choosemoney").css('width', '30%');
            $(".choosemoney").removeClass('current');
            $(this).css('background', '#8b7de7');
            $(this).css('color', 'white');
            //$(this).css('border', '0px')
            //$(this).css('height', '35px')
            //$(this).css('width', '91px');
            $(this).addClass('current');
        })
        //充值
        //        $("#pay").click(function () {

        //        });
        $("#chongzhi").click(function () {
            if (typeof ($.cookie('user_token')) == 'undefined' || $.cookie('user_token') == 'null') {
                $("#modal").fadeIn();
                $("#hidebg").show();
            }
            else {
                location.href = "/index/newchongzhi";
            }
        });
        $("#getcash").click(function () {
            if (typeof ($.cookie('user_token')) == 'undefined' || $.cookie('user_token') == 'null') {
                $("#modal").fadeIn();
                $("#hidebg").show();
            }
            else {
                location.href = "/index/newgetcash";
            }
        });

        var i = 0;
        setInterval(function () {
            $('#shclProgress').shCircleLoader('progress', i + '%');
            if (++i > 100) i = 0;
        }, 100);
        function post_lxw(URL, PARAMS) {
            var temp = document.createElement("form");
            temp.action = URL;
            temp.method = "post";
            temp.style.display = "none";
            for (var x in PARAMS) {
                var opt = document.createElement("textarea");
                opt.name = x;
                opt.value = PARAMS[x];
                temp.appendChild(opt);
            }
            document.body.appendChild(temp);
            temp.submit();
            return temp;
        }
    </script>
</body>
</html>
